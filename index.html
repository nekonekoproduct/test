<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç³§é…åˆ†ã®ã‚¸ãƒ¬ãƒ³ãƒ - ä¸–ä»£é–“ã®å¥‘ç´„</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        h1 {
            color: #4a90e2;
            text-align: center;
            border-bottom: 3px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        p {
            margin-bottom: 15px;
        }
        .controls {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin: 30px 0;
        }
        button {
            padding: 15px 25px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: transform 0.1s, box-shadow 0.1s;
            flex-grow: 1;
        }
        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }
        #fairButton {
            background-color: #2ecc71; /* ç·‘ */
            color: white;
            box-shadow: 0 4px #27ad60;
        }
        #emotionalButton {
            background-color: #e74c3c; /* èµ¤ */
            color: white;
            box-shadow: 0 4px #c0392b;
        }
        .result-box {
            border: 2px solid #4a90e2;
            padding: 25px;
            margin-top: 30px;
            border-radius: 10px;
            background-color: #e9f5ff;
        }
        .result-label {
            font-weight: bold;
            display: block;
            margin-top: 15px;
            color: #1a56a0;
        }
        .result-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .result-good { color: #27ae60; }
        .result-bad { color: #c0392b; }
        #initialImpact {
            border-top: 1px dashed #a0c3e8;
            padding-top: 20px;
            margin-top: 20px;
        }
        #initialSacrifice {
            font-size: 16px;
            font-weight: normal;
            color: #555;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>é£Ÿç³§é…åˆ†ã®ã‚¸ãƒ¬ãƒ³ãƒ: 10ä¸–ä»£å¾Œã®æ±ºæ–­</h1>
        <p>ã‚ãªãŸã¯äººå£1000äººã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æœ€é«˜è²¬ä»»è€…ã§ã™ã€‚æœªæ›¾æœ‰ã®é£Ÿç³§å±æ©Ÿã«ç›´é¢ã—ãŸéš›ã€ä»¥ä¸‹ã®ã©ã¡ã‚‰ã®ãƒ«ãƒ¼ãƒ«ã§é…åˆ†ã‚’è¡Œã„ã¾ã™ã‹ï¼Ÿ</p>
        
        <div class="controls">
            <button id="fairButton">ã€å…¬æ­£ãªåˆ¤æ–­ã€‘</button>
            <button id="emotionalButton">ã€æ„Ÿæƒ…çš„ãªåˆ¤æ–­ã€‘</button>
        </div>

        <div class="result-box">
            <h2>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ (10ä¸–ä»£å¾Œ)</h2>
            <div id="resultOutput">
                <p>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ã‚ãªãŸã®æ±ºæ–­ãŒã‚‚ãŸã‚‰ã™10ä¸–ä»£å¾Œã®æœªæ¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            
            <div id="initialImpact">
                <p class="result-label">åˆæœŸã®çŠ ç‰²ï¼ˆç¬¬ä¸€ä¸–ä»£ã®é¸æŠãŒã‚‚ãŸã‚‰ã™å½±éŸ¿ï¼‰:</p>
                <div id="initialSacrifice">---</div>
            </div>
        </div>
        
        <p style="margin-top: 30px; font-size: 14px; color: #777;">â€»ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€AIã«ã‚ˆã‚‹å³æ ¼ãªåˆ¤æ–­ã¨ã€äººé–“çš„ãªæ„Ÿæƒ…ã«ã‚ˆã‚‹åˆ¤æ–­ã®é•·æœŸçš„ãªå½±éŸ¿ã‚’æ¯”è¼ƒã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã§ã™ã€‚</p>
    </div>
    
    <script>
        // --- 1. å®šæ•°ã¨åˆæœŸè¨­å®š ---
        const POPULATION_SIZE = 1000;
        const FOOD_CRISIS_MAGNITUDE = 0.5; // é£Ÿç³§å±æ©Ÿã«ã‚ˆã‚‹ç”Ÿç”£é‡æ¸›å°‘ç‡ 
        const MAX_GENERATIONS = 10;
        const CONSUMPTION_PER_PERSON = 3; 

        // --- 2. ä»®æƒ³äººå£ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ (generatePopulationData) ---
        function generatePopulationData(size) {
            const data = [];
            const AGE_GROUPS = {
                'child': [0, 15, 0.20], 
                'producer': [16, 65, 0.60], 
                'elder': [66, 90, 0.20]
            };
            
            let ages = [];
            // å¹´é½¢ã¨ä¸–ä»£ã®ãƒ©ãƒ³ãƒ€ãƒ å‰²ã‚Šå½“ã¦
            for (const group in AGE_GROUPS) {
                const [start, end, ratio] = AGE_GROUPS[group];
                const count = Math.floor(size * ratio);
                for(let i=0; i<count; i++) {
                    ages.push(Math.floor(Math.random() * (end - start + 1)) + start);
                }
            }
            
            // ã‚µã‚¤ã‚ºèª¿æ•´ã¨ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            ages = ages.slice(0, size);
            ages.sort(() => Math.random() - 0.5);

            for (let i = 0; i < len(ages); i++) {
                const age = ages[i];
                let group_name, occupation, production_score, past_contribution, health_status;

                if (age <= 15) {
                    group_name = 'ğŸ‘¶ å­ä¾›';
                    occupation = 'ç„¡è·/å­¦ç”Ÿ';
                    production_score = 0;
                    past_contribution = 0;
                } else if (age >= 66) {
                    group_name = 'ğŸ§“ é«˜é½¢è€…';
                    occupation = 'å¼•é€€æ¸ˆã¿';
                    production_score = 0;
                    past_contribution = Math.floor(Math.random() * 41) + 10 + (age - 66);
                } else {
                    group_name = 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£';
                    const occupations = ['é£Ÿç³§ç”Ÿç”£è€…', 'æŠ€è¡“é–‹ç™ºè€…', 'ä¸€èˆ¬åŠ´åƒè€…', 'ã‚µãƒ¼ãƒ“ã‚¹æ¥­'];
                    occupation = occupations[Math.floor(Math.random() * occupations.length)];
                    
                    if (occupation === 'é£Ÿç³§ç”Ÿç”£è€…') {
                        production_score = Math.floor(Math.random() * 6) + 5;
                    } else if (occupation === 'æŠ€è¡“é–‹ç™ºè€…') {
                        production_score = (Math.floor(Math.random() * 6) + 3) * 1.5;
                    } else {
                        production_score = Math.floor(Math.random() * 6) + 1;
                    }
                    past_contribution = production_score * 5 + Math.floor(Math.random() * 11);
                }

                health_status = ['å¥åº·', 'è»½åº¦ã®ç—…', 'é‡åº¦ã®ç—…'][Math.floor(Math.random() * 3)];
                
                data.push({
                    id: i + 1,
                    age: age,
                    group: group_name,
                    production: production_score,
                    contribution: past_contribution,
                    health: health_status
                });
            }
            return data;
        }

        // --- 3. ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ã‚¢é–¢æ•° (runSimulation) ---
        function runSimulation(initialPop, ruleType) {
            let currentPop = JSON.parse(JSON.stringify(initialPop));
            let technologyLevel = 1.0;
            
            for (let generation = 0; generation < MAX_GENERATIONS; generation++) {
                if (currentPop.length === 0) break;

                // A. é£Ÿç³§è¨ˆç®—
                const totalConsumptionNeed = currentPop.length * CONSUMPTION_PER_PERSON;
                const totalProductionScore = currentPop.reduce((sum, p) => sum + p.production, 0);
                const foodProduced = totalProductionScore * technologyLevel * FOOD_CRISIS_MAGNITUDE;

                // B. ç”Ÿå­˜åˆ¤å®š
                let survivors = [];
                if (foodProduced < totalConsumptionNeed) {
                    
                    // å„ªå…ˆåº¦è¨ˆç®—
                    currentPop.forEach(p => {
                        let priority = 0;
                        if (ruleType === 'fair') {
                            // å…¬æ­£ãªãƒ«ãƒ¼ãƒ«: ç”Ÿç”£æ€§ãƒ»è‹¥ã•å„ªå…ˆ
                            priority = (p.production * 10) + 
                                       (100 - p.age) * 0.5 + 
                                       (p.contribution * 0.1);
                        } else if (ruleType === 'emotional') {
                            // æ„Ÿæƒ…çš„ãªãƒ«ãƒ¼ãƒ«: å¼±è€…ãƒ»éå»ã®è²¢çŒ®å„ªå…ˆ
                            let healthScore = (p.health === 'é‡åº¦ã®ç—…') ? 10 : (p.health === 'è»½åº¦ã®ç—…' ? 5 : 1);
                            let ageScore = (p.age >= 66) ? p.age * 0.5 : 0;
                            priority = healthScore + ageScore + (p.contribution * 5);
                        }
                        p.priority = priority;
                    });

                    // å„ªå…ˆåº¦é †ã«ã‚½ãƒ¼ãƒˆã—ã¦ç”Ÿå­˜è€…ã‚’æ±ºå®š
                    currentPop.sort((a, b) => b.priority - a.priority);
                    const survivorCount = Math.floor(foodProduced / CONSUMPTION_PER_PERSON);
                    survivors = currentPop.slice(0, survivorCount);
                    
                } else {
                    // é£Ÿç³§ãŒè¶³ã‚Šã¦ã„ã‚‹å ´åˆ
                    survivors = currentPop;
                }
                
                // C. ä¸–ä»£äº¤ä»£
                if (survivors.length === 0) break;
                
                // æŠ€è¡“ãƒ¬ãƒ™ãƒ«ã®æ›´æ–°
                const survivorProducerScore = survivors.filter(p => p.group === 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£').reduce((sum, p) => sum + p.production, 0);
                const techBoost = totalProductionScore > 0 ? survivorProducerScore / totalProductionScore : 0;
                technologyLevel *= (1 + techBoost * 0.1);
                
                // å¹´é½¢å¢—åŠ 
                let nextGenPop = survivors.filter(p => p.age < 90).map(p => ({
                    ...p,
                    age: p.age + 1,
                    group: (p.age + 1 >= 66) ? 'ğŸ§“ é«˜é½¢è€…' : (p.age + 1 <= 15 ? 'ğŸ‘¶ å­ä¾›' : 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£')
                }));
                
                // æ–°ç”Ÿå…ã®è¿½åŠ 
                const nextGenCount = Math.floor(survivors.length * 0.15);
                const newBabies = generatePopulationData(nextGenCount).filter(p => p.group === 'ğŸ‘¶ å­ä¾›');
                
                currentPop = nextGenPop.concat(newBabies);
            }

            // æœ€çµ‚çµæœã¨åˆå›ã®çŠ ç‰²ã‚’è¨ˆç®—
            const finalPopulation = currentPop.length;
            const firstGenResults = runFirstGeneration(initialPop, ruleType); // åˆä»£ã®çµæœã‚’å†è¨ˆç®—

            return { 
                finalPopulation: finalPopulation,
                finalTechnology: technologyLevel.toFixed(2),
                initialProducerSurvival: firstGenResults.producerSurvivalRate,
                initialElderSurvival: firstGenResults.elderSurvivalRate,
                ruleType: ruleType 
            };
        }

        // åˆä»£ã®ç”Ÿå­˜ç‡è¨ˆç®—ã®ãŸã‚ã®è£œåŠ©é–¢æ•°
        function runFirstGeneration(initialPop, ruleType) {
            let currentPop = JSON.parse(JSON.stringify(initialPop));
            const totalConsumptionNeed = currentPop.length * CONSUMPTION_PER_PERSON;
            const totalProductionScore = currentPop.reduce((sum, p) => sum + p.production, 0);
            const foodProduced = totalProductionScore * 1.0 * FOOD_CRISIS_MAGNITUDE;
            
            // å„ªå…ˆåº¦è¨ˆç®—
            currentPop.forEach(p => {
                let priority = 0;
                if (ruleType === 'fair') {
                    priority = (p.production * 10) + (100 - p.age) * 0.5 + (p.contribution * 0.1);
                } else if (ruleType === 'emotional') {
                    let healthScore = (p.health === 'é‡åº¦ã®ç—…') ? 10 : (p.health === 'è»½åº¦ã®ç—…' ? 5 : 1);
                    let ageScore = (p.age >= 66) ? p.age * 0.5 : 0;
                    priority = healthScore + ageScore + (p.contribution * 5);
                }
                p.priority = priority;
            });

            currentPop.sort((a, b) => b.priority - a.priority);
            const survivorCount = Math.floor(foodProduced / CONSUMPTION_PER_PERSON);
            const survivors = currentPop.slice(0, survivorCount);

            const producerSurvivors = survivors.filter(p => p.group === 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£').length;
            const elderSurvivors = survivors.filter(p => p.group === 'ğŸ§“ é«˜é½¢è€…').length;
            
            const initialProducerCount = currentPop.filter(p => p.group === 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£').length;
            const initialElderCount = currentPop.filter(p => p.group === 'ğŸ§“ é«˜é½¢è€…').length;

            return {
                producerSurvivalRate: initialProducerCount > 0 ? producerSurvivors / initialProducerCount : 0,
                elderSurvivalRate: initialElderCount > 0 ? elderSurvivors / initialElderCount : 0
            };
        }
        
        // len() ã®ãƒãƒªãƒ•ã‚£ãƒ« (Pythonã® len ã®ä»£ã‚ã‚Š)
        function len(arr) {
            return arr.length;
        }


        // --- 4. ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© ---
        // ãƒ©ãƒ³ãƒ€ãƒ ãªåˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã ã‘ç”Ÿæˆ
        const initialPopulationData = generatePopulationData(POPULATION_SIZE);

        document.getElementById('fairButton').addEventListener('click', () => {
            runAndDisplay('fair');
        });

        document.getElementById('emotionalButton').addEventListener('click', () => {
            runAndDisplay('emotional');
        });

        function runAndDisplay(rule) {
            const isFair = rule === 'fair';
            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ (åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãŸã³ã«åŒã˜ãƒ‡ãƒ¼ã‚¿ã§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã•ã‚Œã‚‹)
            const result = runSimulation(JSON.parse(JSON.stringify(initialPopulationData)), rule); 
            const output = document.getElementById('resultOutput');
            const impact = document.getElementById('initialSacrifice');
            
            // åˆæœŸå½±éŸ¿ã®è¡¨ç¤º
            const elderSurvival = (result.initialElderSurvival * 100).toFixed(1);
            const producerSurvival = (result.initialProducerSurvival * 100).toFixed(1);

            let impactText = '';
            if (isFair) {
                impactText = `
                    <span style="color:#c0392b;">é«˜é½¢è€…ã®ç”Ÿå­˜ç‡: ${elderSurvival}%</span> (ã»ã¼å…¨å“¡ãŒçŠ ç‰²)
                    <br>
                    <span style="color:#27ae60;">ç”Ÿç”£ä¸–ä»£ã®ç”Ÿå­˜ç‡: ${producerSurvival}%</span> (æœªæ¥ã®ç”Ÿç”£åŠ›ã‚’æœ€å¤§é™ã«ç¶­æŒ)
                `;
            } else {
                impactText = `
                    <span style="color:#27ae60;">é«˜é½¢è€…ã®ç”Ÿå­˜ç‡: ${elderSurvival}%</span> (å„ªå…ˆçš„ã«ä¿è­·)
                    <br>
                    <span style="color:#c0392b;">ç”Ÿç”£ä¸–ä»£ã®ç”Ÿå­˜ç‡: ${producerSurvival}%</span> (ç”Ÿç”£åŠ›ã®å¤§å¹…ãªæ¸›å°‘ã‚’æ‹›ã)
                `;
            }
            impact.innerHTML = impactText;
            
            // æœ€çµ‚çµæœã®è¡¨ç¤º
            const finalPopValue = parseInt(result.finalPopulation);
            const isProsperous = finalPopValue >= 600; // 600äººä»¥ä¸Šã‚’ç¹æ „ã¨å®šç¾©
            
            output.innerHTML = `
                <p class="result-label">é¸æŠã•ã‚ŒãŸãƒ«ãƒ¼ãƒ«:</p>
                <span class="result-value">${isFair ? 'ã€å…¬æ­£ãªåˆç†æ€§ã€‘' : 'ã€æ„Ÿæƒ…çš„ãªé…åˆ†ã€‘'}</span>
                
                <p class="result-label">æœ€çµ‚ç”Ÿå­˜äººå£ (10ä¸–ä»£å¾Œ):</p>
                <span class="result-value ${isProsperous ? 'result-good' : 'result-bad'}">${finalPopValue}äºº</span>
                
                <p class="result-label">è©•ä¾¡:</p>
                <span class="result-value ${isProsperous ? 'result-good' : 'result-bad'}">${isProsperous ? 'ğŸ‰ æœªæ¥ã®ç¹æ „ã‚’é”æˆ' : 'ğŸ˜” äººå£ã¯å¤§å¹…ã«åœæ»ãƒ»æ¸›å°‘'}</span>
                
                <p class="result-label">æœ€çµ‚æŠ€è¡“ãƒ¬ãƒ™ãƒ«:</p>
                <span class="result-value">${result.finalTechnology}</span>
            `;

            // çµæœã®è€ƒå¯Ÿ
            const conclusion = document.createElement('p');
            conclusion.style.marginTop = '20px';
            conclusion.style.fontSize = '15px';
            conclusion.style.color = '#1a56a0';
            
            if (isFair) {
                conclusion.innerHTML = `**è€ƒå¯Ÿ:** çŸ­æœŸçš„ãªçŠ ç‰²ã‚’æ‰•ã£ãŸçµæœã€ç”Ÿç”£åŠ›ã®ç¶­æŒã¨æŠ€è¡“ã®é€²æ­©ãŒç¢ºä¿ã•ã‚Œã€**é•·æœŸçš„ã«ã¯ã‚ˆã‚Šå¤šãã®å‘½ã‚’æ•‘ã†**ã¨ã„ã†**ç©¶æ¥µã®å„ªã—ã•**ãŒè¨¼æ˜ã•ã‚Œã¾ã—ãŸã€‚`;
            } else {
                conclusion.innerHTML = `**è€ƒå¯Ÿ:** çŸ­æœŸçš„ãªé“å¾³çš„è²¬ä»»ã‚’æœãŸã—ã¾ã—ãŸãŒã€æœªæ¥ã®ç”Ÿç”£åŠ›ãŒå¤±ã‚ã‚ŒãŸãŸã‚ã€ç¤¾ä¼šã¯ç¸®å°ãƒ»åœæ»ã—ã€**é•·æœŸçš„ã«ã¯ã‚ˆã‚Šå°‘ãªã„å‘½ã—ã‹æ•‘ãˆã¾ã›ã‚“ã§ã—ãŸã€‚**`;
            }
            output.appendChild(conclusion);
        }
    </script>
</body>
</html>
