<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€ä¸–è«–ã¨æ±ºæ–­ã€‘10ä¸–ä»£ã®å€«ç†ã¨ç”Ÿå­˜æˆ¦ç•¥</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        h1 {
            color: #4a90e2;
            text-align: center;
            border-bottom: 3px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 25px;
            font-size: 24px; /* ã‚¹ãƒãƒ›ã§è¦‹ã‚„ã™ã„ã‚ˆã†ã«èª¿æ•´ */
        }
        .info-box {
            display: flex;
            justify-content: space-around;
            background: #e9f5ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap; /* ã‚¹ãƒãƒ›ã§4é …ç›®ãŒæŠ˜ã‚Šè¿”ã™ã‚ˆã†ã« */
        }
        .stat {
            text-align: center;
            flex: 1 1 45%; 
            min-width: 100px;
            margin: 5px 0;
        }
        .stat-label {
            font-size: 13px;
            color: #1a56a0;
            font-weight: bold;
            margin-bottom: 3px;
        }
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        .stat-good { color: #2ecc71; }
        .stat-bad { color: #e74c3c; }
        .controls {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #a0c3e8;
            border-radius: 10px;
        }
        .controls h2 {
            color: #4a90e2;
            margin-top: 0;
            font-size: 20px;
        }
        
        /* 3ã¤ã®ãƒœã‚¿ãƒ³ãŒç¸¦ã«ä¸¦ã¶ã‚ˆã†ã«èª¿æ•´ */
        #mainSelectionButtons {
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 20px;
        }

        /* ãƒœã‚¿ãƒ³ã®å¹…ã‚’ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´ */
        button {
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: transform 0.1s, box-shadow 0.1s;
            margin: 8px 0; 
            width: 95%; 
            max-width: 380px; 
            box-shadow: 0 4px #4a4a4a;
            background-color: #f0f0f0;
            color: #333;
        }
        button:hover {
            opacity: 0.9;
        }
        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }
        #proposedPolicy {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            padding: 10px;
            background: #e9f5ff;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .result-final-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        .hidden-indicator {
            font-size: 14px;
            color: #555;
            margin-top: 15px;
            border-top: 1px dashed #ccc;
            padding-top: 10px;
        }
        .hidden-indicator span {
            font-weight: bold;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ã€ä¸–è«–ã¨æ±ºæ–­ã€‘10ä¸–ä»£ã®å€«ç†ã¨ç”Ÿå­˜æˆ¦ç•¥</h1>
        <p>ã‚ãªãŸã¯æœ€é«˜æŒ‡å°è€…ã§ã™ã€‚æ¯ä¸–ä»£ã€ä¸–è«–ã®ææ¡ˆã«å¯¾ã—ã€3ã¤ã®é¸æŠè‚¢ã‹ã‚‰æ±ºæ–­ã—ã¦ãã ã•ã„ã€‚</p>
        
        <div class="info-box">
            <div class="stat">
                <div class="stat-label">ç¾åœ¨ä¸–ä»£</div>
                <div class="stat-value" id="currentGeneration">1 / 10</div>
            </div>
            <div class="stat">
                <div class="stat-label">ç”Ÿå­˜äººå£</div>
                <div class="stat-value" id="currentPopulation">1000</div>
            </div>
            <div class="stat">
                <div class="stat-label">ç¤¾ä¼šãƒ¢ãƒ©ãƒ«</div>
                <div class="stat-value" id="currentMorale">100</div>
            </div>
            <div class="stat">
                <div class="stat-label">é£Ÿç³§çŠ¶æ³ (ç”Ÿç”£/æ¶ˆè²»)</div>
                <div class="stat-value" id="currentProduction">-- / --</div>
            </div>
        </div>

        <div class="controls" id="selectionArea">
            <h2 id="controlTitle">æœ€é«˜æŒ‡å°è€…ã®æ±ºæ–­ (ç¬¬ 1 / 10)</h2>
            <p id="controlDescription">ä¸–è«–ã¯æ¬¡ã®é…åˆ†ãƒ«ãƒ¼ãƒ«ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚</p>
            
            <div id="proposedPolicy">ä¸–è«–ã®ææ¡ˆã‚’ç”Ÿæˆä¸­ã§ã™...</div>

            <div id="mainSelectionButtons">
                <button id="choiceAccept" style="background-color: #2ecc71; color: white; box-shadow: 0 4px #27ae60;">
                    âœ… æ±ºå®š (ææ¡ˆé€šã‚Šã«é€²ã‚ã‚‹)
                </button>
                <button id="choiceModerate" style="background-color: #f39c12; color: white; box-shadow: 0 4px #e67e22;">
                    âš–ï¸ èª¿æ•´ (å‡è¡¡é…åˆ† P2ã‚’ä»£ã‚ã‚Šã«å®Ÿè¡Œ)
                </button>
                <button id="choiceRebel" style="background-color: #e74c3c; color: white; box-shadow: 0 4px #c0392b;">
                    âŒ åæŠ— (ä¸–è«–ã«é€†ã‚‰ã„ã€çœŸé€†ã®æ”¿ç­–ã‚’å¼·è¡Œã™ã‚‹)
                </button>
            </div>
        </div>

        <div id="resultOutput" style="display: none;">
            <h2>ğŸš¨ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº† ğŸš¨</h2>
            <p>ã‚ãªãŸã®æ±ºæ–­ãŒã‚‚ãŸã‚‰ã—ãŸ10ä¸–ä»£å¾Œã®çµæœã§ã™ã€‚</p>
            <p class="result-label">æœ€çµ‚ç”Ÿå­˜äººå£:</p>
            <span class="result-final-value" id="finalPopulationResult"></span>
            <p class="result-label">æœ€çµ‚ç¤¾ä¼šãƒ¢ãƒ©ãƒ«:</p>
            <span class="result-final-value" id="finalMoraleResult"></span>
            <p class="hidden-indicator">
                ã€éš ã‚ŒãŸæŒ‡æ¨™ã€‘<br>
                ä¸–è«–ã¨ã®æ‘©æ“¦ (åæŠ—å›æ•°): <span id="rebelCount">0</span>å› <br>
                é£¢é¤“ç™ºç”Ÿå›æ•°: <span id="famineCount">0</span>å›
            </p>
        </div>
    </div>
    
    <script>
        // --- 1. å®šæ•°ã¨åˆæœŸè¨­å®š ---
        const POPULATION_SIZE = 1000;
        const MAX_GENERATIONS = 10; 
        const CONSUMPTION_PER_PERSON = 3.5; 
        const FOOD_CRISIS_MAGNITUDE = 0.35; 
        const MORALE_LOW_THRESHOLD = 50; 
        const REBEL_MORALE_PENALTY = 10; 

        let currentGeneration = 1;
        let currentMorale = 100;
        let famineCounter = 0;
        let rebelCounter = 0;
        
        // --- 2. æ–°ã—ã„é…åˆ†ãƒ«ãƒ¼ãƒ« (4ç¨®é¡) ---
        const DISTRIBUTION_POLICIES = [
            { id: 'P1', label: 'ç”Ÿç”£æ€§çµ¶å¯¾å„ªå…ˆ (é«˜ç”Ÿç”£åšé‡)', boost: 0.15, morale_impact: -10, description: 'é«˜ç”Ÿç”£è€…ã«é‡ç‚¹é…åˆ†ã€‚æœ€å¤§åŠ¹ç‡ã‚’è¿½æ±‚ã—ã¾ã™ã€‚' },
            { id: 'P2', label: 'å‡è¡¡é…åˆ† (å…¨å“¡å‡ç­‰)', boost: 0.05, morale_impact: 0, description: 'å…¨ã‚°ãƒ«ãƒ¼ãƒ—ã«å‡ç­‰é…åˆ†ã€‚å®‰å®šã—ãŸæˆé•·ã‚’ç›®æŒ‡ã—ã¾ã™ã€‚' },
            { id: 'P3', label: 'å¼±è€…å„ªå…ˆ (ç„¡ç”Ÿç”£åšé‡)', boost: -0.05, morale_impact: 15, description: 'ç„¡ç”Ÿç”£è€…ã‚’ä¿è­·ã€‚ãƒ¢ãƒ©ãƒ«ã‚’é‡è¦–ã—ã¾ã™ã€‚' },
            { id: 'P4', label: 'èª¿æ•´å‹ (é«˜ç”Ÿç”£æ™®é€š, ç„¡ç”Ÿç”£å¤šã‚)', boost: 0.0, morale_impact: 5, description: 'é«˜ç”Ÿç”£è€…ã¨å¼±è€…ã®é–“ã§åˆ©ç›Šã‚’èª¿æ•´ã—ã¾ã™ã€‚' }
        ];

        // --- 3. å›½æ°‘åˆ†é¡ã®é–¢æ•° (å¤‰æ›´ãªã—) ---
        function classifyPopulation(population) {
            const producers = population.filter(p => p.group === 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£');
            
            producers.sort((a, b) => b.production - a.production);
            const highProdCount = Math.ceil(producers.length * 0.4);
            
            let classified = {
                high_prod: [],
                mid_prod: [],
                non_prod: population.filter(p => p.group !== 'ğŸ§‘ ç”Ÿç”£ä¸–ä»£')
            };

            producers.forEach((p, index) => {
                p.category = (index < highProdCount) ? 'é«˜ç”Ÿç”£' : 'ä¸­ç”Ÿç”£';
                if (index < highProdCount) {
                    classified.high_prod.push(p);
                } else {
                    classified.mid_prod.push(p);
                }
            });

            return classified;
        }

        // --- 4. ä¸–è«–ææ¡ˆãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—) ---
        function generateProposal(moraleScore, currentPop, classifiedPop) {
            const highProdRatio = classifiedPop.high_prod.length / currentPop.length;
            const nonProdRatio = classifiedPop.non_prod.length / currentPop.length;

            let moraleInfluence = (moraleScore / 100) * 0.5
